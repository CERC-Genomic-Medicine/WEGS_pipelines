# Joint genotyping

This pipeline performs joint genotyping on many individuals using the GATK v4 GenotypeGVCFs tool. In addition, the pipeline annotates variants as PASS or FAIL quality filters using the GATK v4 VariantRecalibrator tool.

> [!CAUTION]  
> This pipeline expects that the GenomicsDB folder was generated by the **HaplotypeCaller** sub-pipeline and will not work otherwise. The **HaplotypeCaller** organized the GenomicsDB folder so that only genotypes from the corresponding interval can be staged to the compute nodes for efficient local data access.

> [!CAUTION]
> If you do a small study on related individuals (e.g. trios), then use the ```pedigree``` configuration parameter to specify PED file describing parent-offspring relationships. This will ensure that only unrelated parents are used for estimating inbreeding coefficients and testing for excess of heterozygosity.

## Assumptions

The input GenomicsDB folder, which stores per-individual genotypes, was generated using the **HaplotypeCaller** sup-pipeline.

## Parallelization

The pipeline distributes computations by splitting the genome into the [GATK's pre-defined intervals](https://gatk.broadinstitute.org/hc/en-us/articles/360035531852-Intervals-and-interval-lists) and analyzing each interval in-parallel. The genome splitting was performed by the preceding **HaplotypeCaller** sup-pipeline and, thus, no additional configuration parameters are needed.

## Dependencies/pre-requisites
* Nextflow
* apptainer
* GATK v4 apptainer/singularity image build from [GATK's docker repository](https://hub.docker.com/r/broadinstitute/gatk/) 
* [GATK v4 resource bundle](https://gatk.broadinstitute.org/hc/en-us/articles/360035890811-Resource-bundle)
* Human genome reference file (i.e. *.fa and associated indices)
* bcftools
* tabix
